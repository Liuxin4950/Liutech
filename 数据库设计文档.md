# 个人博客数据库设计完善版



### 2.1 用户表（`users`）

| 字段名        | 类型             | 备注                               |
| ------------- | ---------------- | ---------------------------------- |
| id            | BIGINT PK        | 自增主键                           |
| username      | VARCHAR(150)     | 唯一用户名，允许特殊字符请考虑编码 |
| email         | VARCHAR(320)     | 兼容最长邮箱格式，唯一索引         |
| password_hash | VARCHAR(255)     | 推荐使用bcrypt或argon2加密         |
| avatar_url    | VARCHAR(512)     | 头像图片URL                        |
| points        | DECIMAL(12,2)    | 积分，支持较大值和小数             |
| status        | TINYINT UNSIGNED | 0禁用，1正常，2待审核等            |
| last_login_at | TIMESTAMP NULL   | 最近登录时间                       |
| created_at    | TIMESTAMP        | 创建时间，默认UTC时间              |
| updated_at    | TIMESTAMP        | 更新时间                           |
| created_by    | BIGINT NULL      | 创建人ID，一般为空或自己           |
| updated_by    | BIGINT NULL      | 更新人ID                           |
| deleted_at    | TIMESTAMP NULL   | 软删除时间                         |

------

### 2.2 邮箱验证码表（`email_verifications`）

| 字段名     | 类型                              | 备注     |
| ---------- | --------------------------------- | -------- |
| id         | BIGINT PK                         | 主键     |
| email      | VARCHAR(320)                      | 验证邮箱 |
| code       | VARCHAR(10)                       | 验证码   |
| purpose    | ENUM('register','reset','change') | 用途     |
| expires_at | TIMESTAMP                         | 过期时间 |
| created_at | TIMESTAMP                         | 创建时间 |

------

### 2.3 文章表（`posts`）

| 字段名      | 类型           | 备注             |
| ----------- | -------------- | ---------------- |
| id          | BIGINT PK      | 主键             |
| title       | VARCHAR(255)   | 文章标题         |
| content     | LONGTEXT       | Markdown格式正文 |
| summary     | VARCHAR(500)   | 摘要             |
| category_id | BIGINT FK      | 外键，关联分类   |
| author_id   | BIGINT FK      | 外键，作者       |
| status      | VARCHAR(20)    | 文章状态：draft草稿/published已发布/archived已归档 |
| created_at  | TIMESTAMP      | 创建时间         |
| updated_at  | TIMESTAMP      | 更新时间         |
| created_by  | BIGINT NULL    | 创建人ID         |
| updated_by  | BIGINT NULL    | 更新人ID         |
| deleted_at  | TIMESTAMP NULL | 软删除时间       |

------

### 2.4 分类表（`categories`）

| 字段名      | 类型         | 备注           |
| ----------- | ------------ | -------------- |
| id          | BIGINT PK    | 主键           |
| name        | VARCHAR(150) | 唯一分类名     |
| description | VARCHAR(255) | 分类描述，可空 |

------

### 2.5 标签表（`tags`）

| 字段名 | 类型         | 备注       |
| ------ | ------------ | ---------- |
| id     | BIGINT PK    | 主键       |
| name   | VARCHAR(100) | 唯一标签名 |

------

### 2.6 文章-标签关联表（`post_tags`）

| 字段名                       | 类型      | 备注             |
| ---------------------------- | --------- | ---------------- |
| post_id                      | BIGINT FK | 文章ID           |
| tag_id                       | BIGINT FK | 标签ID           |
| PRIMARY KEY(post_id, tag_id) |           | 复合主键防止重复 |

------

### 2.7 评论表（`comments`）

| 字段名     | 类型           | 备注                   |
| ---------- | -------------- | ---------------------- |
| id         | BIGINT PK      | 主键                   |
| post_id    | BIGINT FK      | 外键，文章ID           |
| user_id    | BIGINT FK      | 外键，评论用户ID       |
| content    | TEXT           | 评论内容               |
| parent_id  | BIGINT NULL    | 父评论ID，支持多层回复 |
| created_at | TIMESTAMP      | 创建时间               |
| updated_at | TIMESTAMP      | 更新时间               |
| deleted_at | TIMESTAMP NULL | 软删除时间             |

------

### 2.8 资源表（`resources`）

| 字段名        | 类型             | 备注               |
| ------------- | ---------------- | ------------------ |
| id            | BIGINT PK        | 主键               |
| name          | VARCHAR(255)     | 资源名             |
| description   | VARCHAR(1000)    | 资源描述           |
| file_url      | VARCHAR(512)     | 文件存储路径或URL  |
| uploader_id   | BIGINT FK        | 上传者ID           |
| download_type | TINYINT UNSIGNED | 0=免费，1=积分下载 |
| points_needed | DECIMAL(12,2)    | 积分下载所需积分   |
| created_at    | TIMESTAMP        | 创建时间           |
| updated_at    | TIMESTAMP        | 更新时间           |
| deleted_at    | TIMESTAMP NULL   | 软删除时间         |

------

### 2.9 下载记录表（`download_logs`）

| 字段名        | 类型          | 备注       |
| ------------- | ------------- | ---------- |
| id            | BIGINT PK     | 主键       |
| user_id       | BIGINT FK     | 下载用户ID |
| resource_id   | BIGINT FK     | 资源ID     |
| points_used   | DECIMAL(12,2) | 使用积分   |
| downloaded_at | TIMESTAMP     | 下载时间   |



### 3.关系图

可以在dbdiagram.io查看在关系图

```SQl
Table users {
  id bigint [pk, increment]
  username varchar(150) [unique, not null]
  email varchar(320) [unique, not null]
  password_hash varchar(255) [not null]
  avatar_url varchar(512)
  points decimal(12,2) [default: 0]
  status tinyint [default: 1]
  last_login_at timestamp
  created_at timestamp [not null]
  updated_at timestamp [not null]
  created_by bigint
  updated_by bigint
  deleted_at timestamp
}

Table email_verifications {
  id bigint [pk, increment]
  email varchar(320) [not null]
  code varchar(10) [not null]
  purpose enum('register', 'reset', 'change') [not null]
  expires_at timestamp [not null]
  created_at timestamp [not null]
}

Table categories {
  id bigint [pk, increment]
  name varchar(150) [unique, not null]
  description varchar(255)
}

Table posts {
  id bigint [pk, increment]
  title varchar(255) [not null]
  content longtext [not null]
  summary varchar(500)
  category_id bigint [ref: > categories.id]
  author_id bigint [ref: > users.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  created_by bigint
  updated_by bigint
  deleted_at timestamp
}

Table tags {
  id bigint [pk, increment]
  name varchar(100) [unique, not null]
}

Table post_tags {
  post_id bigint [ref: > posts.id]
  tag_id bigint [ref: > tags.id]
  indexes {
    (post_id, tag_id) [pk]
  }
}

Table comments {
  id bigint [pk, increment]
  post_id bigint [ref: > posts.id]
  user_id bigint [ref: > users.id]
  content text [not null]
  parent_id bigint
  created_at timestamp [not null]
  updated_at timestamp [not null]
  deleted_at timestamp
}

Table resources {
  id bigint [pk, increment]
  name varchar(255) [not null]
  description varchar(1000)
  file_url varchar(512) [not null]
  uploader_id bigint [ref: > users.id]
  download_type tinyint [default: 0]
  points_needed decimal(12,2) [default: 0]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  deleted_at timestamp
}

Table download_logs {
  id bigint [pk, increment]
  user_id bigint [ref: > users.id]
  resource_id bigint [ref: > resources.id]
  points_used decimal(12,2)
  downloaded_at timestamp [not null]
}

```



### 4.SQL语句

```sql
-- 用户表
CREATE TABLE users (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
  username VARCHAR(150) NOT NULL UNIQUE COMMENT '用户名',
  email VARCHAR(320) NOT NULL UNIQUE COMMENT '邮箱',
  password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
  avatar_url VARCHAR(512) DEFAULT NULL COMMENT '头像URL',
  points DECIMAL(12,2) NOT NULL DEFAULT 0 COMMENT '用户积分',
  status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '用户状态(0禁用,1正常)',
  last_login_at TIMESTAMP NULL DEFAULT NULL COMMENT '最近登录时间',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  created_by BIGINT DEFAULT NULL COMMENT '创建人ID',
  updated_by BIGINT DEFAULT NULL COMMENT '更新人ID',
  deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT '软删除时间',
  INDEX idx_username (username),
  INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 邮箱验证码表
CREATE TABLE email_verifications (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键',
  email VARCHAR(320) NOT NULL COMMENT '验证邮箱',
  code VARCHAR(10) NOT NULL COMMENT '验证码',
  purpose ENUM('register', 'reset', 'change') NOT NULL COMMENT '用途',
  expires_at TIMESTAMP NOT NULL COMMENT '过期时间',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='邮箱验证码表';

-- 分类表
CREATE TABLE categories (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '分类ID',
  name VARCHAR(150) NOT NULL UNIQUE COMMENT '分类名',
  description VARCHAR(255) DEFAULT NULL COMMENT '分类描述'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章分类表';

-- 文章表
CREATE TABLE posts (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '文章ID',
  title VARCHAR(255) NOT NULL COMMENT '文章标题',
  content LONGTEXT NOT NULL COMMENT '文章内容（Markdown）',
  summary VARCHAR(500) DEFAULT NULL COMMENT '摘要',
  category_id BIGINT NOT NULL COMMENT '分类ID',
  author_id BIGINT NOT NULL COMMENT '作者ID',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  created_by BIGINT DEFAULT NULL COMMENT '创建人ID',
  updated_by BIGINT DEFAULT NULL COMMENT '更新人ID',
  deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT '软删除时间',
  INDEX idx_category_id (category_id),
  INDEX idx_author_id (author_id),
  FOREIGN KEY (category_id) REFERENCES categories(id),
  FOREIGN KEY (author_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章表';

-- 标签表
CREATE TABLE tags (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '标签ID',
  name VARCHAR(100) NOT NULL UNIQUE COMMENT '标签名'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='标签表';

-- 文章标签关联表
CREATE TABLE post_tags (
  post_id BIGINT NOT NULL COMMENT '文章ID',
  tag_id BIGINT NOT NULL COMMENT '标签ID',
  PRIMARY KEY (post_id, tag_id),
  FOREIGN KEY (post_id) REFERENCES posts(id),
  FOREIGN KEY (tag_id) REFERENCES tags(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章-标签关联表';

-- 评论表
CREATE TABLE comments (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '评论ID',
  post_id BIGINT NOT NULL COMMENT '文章ID',
  user_id BIGINT NOT NULL COMMENT '评论者用户ID',
  content TEXT NOT NULL COMMENT '评论内容',
  parent_id BIGINT DEFAULT NULL COMMENT '父评论ID',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '评论时间',
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT '软删除时间',
  INDEX idx_post_id (post_id),
  INDEX idx_user_id (user_id),
  FOREIGN KEY (post_id) REFERENCES posts(id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (parent_id) REFERENCES comments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';

-- 资源表
CREATE TABLE resources (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '资源ID',
  name VARCHAR(255) NOT NULL COMMENT '资源名称',
  description VARCHAR(1000) DEFAULT NULL COMMENT '资源描述',
  file_url VARCHAR(512) NOT NULL COMMENT '文件存储路径或URL',
  uploader_id BIGINT NOT NULL COMMENT '上传用户ID',
  download_type TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '下载类型（0免费，1积分）',
  points_needed DECIMAL(12,2) NOT NULL DEFAULT 0 COMMENT '下载所需积分',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT '软删除时间',
  INDEX idx_uploader_id (uploader_id),
  FOREIGN KEY (uploader_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='资源表';

-- 下载记录表
CREATE TABLE download_logs (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '记录ID',
  user_id BIGINT NOT NULL COMMENT '下载用户ID',
  resource_id BIGINT NOT NULL COMMENT '资源ID',
  points_used DECIMAL(12,2) DEFAULT 0 COMMENT '使用积分',
  downloaded_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '下载时间',
  INDEX idx_user_id (user_id),
  INDEX idx_resource_id (resource_id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (resource_id) REFERENCES resources(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='下载记录表';

```

