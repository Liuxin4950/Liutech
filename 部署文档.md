# MyBlog 项目部署文档

## 1. 项目概述

本文档详细说明了 MyBlog 项目的部署流程，包括环境配置、构建步骤和部署方法。

### 1.1 技术栈

- 前端框架：Vue 3
- 构建工具：Vite 7
- 编程语言：TypeScript 5.8
- 状态管理：Pinia 3
- 路由管理：Vue Router 4
- HTTP客户端：Axios

## 2. 开发环境配置

### 2.1 环境要求

- Node.js >= 18.0.0 (推荐使用最新的LTS版本)
- npm >= 9.0.0 或 yarn >= 1.22.0
- Git

### 2.2 本地开发环境搭建

1. **克隆代码仓库**

   ```bash
   git clone <仓库地址>
   cd Blog
   ```

2. **安装依赖**

   使用npm：
   ```bash
   npm install
   ```

   或使用yarn：
   ```bash
   yarn
   ```

3. **启动开发服务器**

   ```bash
   npm run dev
   ```

   或
   ```bash
   yarn dev
   ```

   开发服务器将在 http://localhost:5173 启动（默认端口）

## 3. 项目构建

### 3.1 构建生产版本

执行以下命令构建生产环境版本：

```bash
npm run build
```

或

```bash
yarn build
```

构建完成后，生成的静态文件将位于 `dist` 目录中。

### 3.2 本地预览生产构建

构建完成后，可以本地预览生产构建：

```bash
npm run preview
```

或

```bash
yarn preview
```

## 4. 部署方案

### 4.1 静态网站部署

由于本项目是一个纯前端应用，可以部署到任何静态网站托管服务上。

#### 4.1.1 部署到传统Web服务器（Apache/Nginx）

1. **Nginx配置示例**

   ```nginx
   server {
       listen 80;
       server_name yourdomain.com;
       root /path/to/dist;
       index index.html;

       # 处理SPA路由
       location / {
           try_files $uri $uri/ /index.html;
       }

       # 静态资源缓存设置
       location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
           expires 30d;
           add_header Cache-Control "public, no-transform";
       }
   }
   ```

2. **Apache配置示例**

   在网站根目录创建 `.htaccess` 文件：

   ```apache
   <IfModule mod_rewrite.c>
     RewriteEngine On
     RewriteBase /
     RewriteRule ^index\.html$ - [L]
     RewriteCond %{REQUEST_FILENAME} !-f
     RewriteCond %{REQUEST_FILENAME} !-d
     RewriteRule . /index.html [L]
   </IfModule>
   ```

#### 4.1.2 部署到云服务

1. **部署到Netlify**

   - 在Netlify创建新站点
   - 连接到Git仓库
   - 构建命令设置为：`npm run build`
   - 发布目录设置为：`dist`

2. **部署到Vercel**

   - 在Vercel导入项目
   - 构建命令设置为：`npm run build`
   - 输出目录设置为：`dist`

3. **部署到GitHub Pages**

   创建部署脚本 `deploy.sh`：

   ```bash
   #!/usr/bin/env sh

   # 发生错误时终止
   set -e

   # 构建
   npm run build

   # 进入构建文件夹
   cd dist

   # 如果你要部署到自定义域名
   # echo 'www.example.com' > CNAME

   git init
   git add -A
   git commit -m 'deploy'

   # 如果你要部署在 https://<USERNAME>.github.io
   # git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git main

   # 如果你要部署在 https://<USERNAME>.github.io/<REPO>
   git push -f git@github.com:<USERNAME>/<REPO>.git main:gh-pages

   cd -
   ```

   然后执行：
   ```bash
   chmod +x deploy.sh
   ./deploy.sh
   ```

### 4.2 环境变量配置

在不同环境中，可能需要不同的配置（如API地址）。Vite支持使用环境变量来处理这种情况。

1. **创建环境变量文件**

   - `.env`：所有环境都会加载
   - `.env.development`：开发环境加载
   - `.env.production`：生产环境加载

   示例 `.env.production` 文件：
   ```
   VITE_API_URL=https://api.yourdomain.com
   ```

2. **在代码中使用环境变量**

   ```typescript
   const apiUrl = import.meta.env.VITE_API_URL
   ```

## 5. 持续集成/持续部署 (CI/CD)

### 5.1 GitHub Actions配置

在项目根目录创建 `.github/workflows/deploy.yml` 文件：

```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist
          branch: gh-pages
```

## 6. 性能优化建议

### 6.1 构建优化

1. **启用Gzip压缩**

   安装插件：
   ```bash
   npm install vite-plugin-compression -D
   ```

   在 `vite.config.ts` 中配置：
   ```typescript
   import compression from 'vite-plugin-compression';

   export default defineConfig({
     plugins: [
       vue(),
       compression()
     ],
   })
   ```

2. **代码分割**

   在路由配置中使用动态导入：
   ```typescript
   const routes = [
     {
       path: '/about',
       component: () => import('./views/About.vue')
     }
   ]
   ```

### 6.2 部署优化

1. **配置CDN**

   将静态资源部署到CDN以提高加载速度。

2. **配置HTTP缓存**

   确保服务器正确设置了缓存头，特别是对于静态资源。

## 7. 故障排除

### 7.1 常见问题

1. **路由在刷新后404**

   确保服务器配置了正确的重写规则，将所有请求重定向到index.html。

2. **环境变量不生效**

   - 确保环境变量以 `VITE_` 开头
   - 修改环境变量后需要重启开发服务器

3. **构建失败**

   - 检查TypeScript类型错误
   - 确保所有依赖都正确安装

## 8. 维护与更新

### 8.1 依赖更新

定期更新依赖以获取安全补丁和新功能：

```bash
npm update
```

或使用工具如 `npm-check-updates`：

```bash
npx npm-check-updates -u
npm install
```

### 8.2 版本管理

使用语义化版本控制（Semantic Versioning）管理项目版本：

```bash
npm version patch  # 修复bug (1.0.0 -> 1.0.1)
npm version minor  # 新功能 (1.0.0 -> 1.1.0)
npm version major  # 重大更新 (1.0.0 -> 2.0.0)
```

## 9. 联系与支持

如有部署问题，请联系项目维护者：

- 邮箱：[your-email@example.com]
- 项目仓库：[GitHub仓库地址]