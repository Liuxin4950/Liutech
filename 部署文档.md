# LiuTech 博客系统部署文档

> **作者**：刘鑫  
> **更新时间**：2025-08-27

## 📋 目录
1. [项目概述](#1-项目概述)
2. [技术栈架构](#2-技术栈架构)
3. [环境要求](#3-环境要求)
4. [快速部署](#4-快速部署)
5. [数据库配置](#5-数据库配置)
6. [后端部署](#6-后端部署)
7. [前端部署](#7-前端部署)
8. [Nginx 配置](#8-nginx-配置)
9. [Docker 容器化部署](#9-docker-容器化部署)
10. [环境变量配置](#10-环境变量配置)
11. [监控与维护](#11-监控与维护)
12. [故障排除](#12-故障排除)

---

## 1. 项目概述

LiuTech 是一个现代化的个人博客系统，采用前后端分离架构，支持文章发布、分类管理、标签系统、用户认证、文件上传等功能。

### 1.1 项目结构
```
MyBlog/
├── LiuTech/                # Spring Boot 后端
│   ├── src/main/java/      # Java 源码
│   ├── src/main/resources/ # 配置文件
│   └── pom.xml            # Maven 依赖
├── Web/                    # Vue 3 前端
│   ├── src/               # Vue 源码
│   ├── public/            # 静态资源
│   └── package.json       # NPM 依赖
└── pom.xml                # 父模块 Maven 配置
```

---

## 2. 技术栈架构

### 2.1 前端技术栈
- **框架**：Vue 3.5.17 + TypeScript 5.8.3
- **构建工具**：Vite 7.1.3
- **状态管理**：Pinia 3.0.3
- **路由管理**：Vue Router 4.5.1
- **HTTP 客户端**：Axios 1.10.0
- **富文本编辑**：TinyMCE 7.9.1
- **样式预处理**：Sass
- **UI 组件**：SweetAlert2（弹窗提示）

### 2.2 后端技术栈
- **框架**：Spring Boot 3.5.4
- **JDK 版本**：Java 21
- **ORM 框架**：MyBatis-Plus 3.5.12
- **数据库**：MySQL 8.3.0
- **安全框架**：Spring Security + JWT 0.11.5
- **日志框架**：Logback (SLF4J)
- **文档工具**：已有 API 文档
- **构建工具**：Maven 3.x

### 2.3 部署架构
- **前端**：http://localhost:3000 (开发) / Nginx (生产)
- **后端**：http://localhost:8080 (Spring Boot内嵌Tomcat)
- **数据库**：MySQL 8.0+ (本地/云服务器)
- **文件存储**：本地文件系统 + 静态资源服务

---

## 3. 环境要求

### 3.1 开发环境
- **Node.js**：≥ 18.0.0 (推荐 20.x LTS)
- **npm**：≥ 9.0.0 或 yarn ≥ 1.22.0
- **JDK**：21 (OpenJDK 或 Oracle JDK)
- **Maven**：≥ 3.6.0
- **MySQL**：≥ 8.0.0
- **Git**：最新版本

### 3.2 生产环境
- **服务器**：Linux (Ubuntu 20.04+/CentOS 7+)
- **内存**：≥ 4GB RAM
- **存储**：≥ 20GB 可用空间
- **Nginx**：≥ 1.18.0
- **Docker** (可选)：≥ 20.10.0

---

## 4. 快速部署

### 4.1 一键部署脚本
我们提供了完整的一键部署脚本，可以自动完成整个部署过程：

```bash
# 1. 克隆项目到服务器
git clone <repository-url>
cd LiuTech

# 2. 给部署脚本执行权限
chmod +x deploy/*.sh

# 3. 运行一键部署脚本 (需要root权限)
sudo ./deploy/deploy-all.sh
```

一键部署脚本将自动完成：
- ✅ 系统环境配置 (Java 21, Node.js, MySQL, Nginx等)
- ✅ 数据库创建和配置
- ✅ 后端服务构建和部署
- ✅ 前端应用构建和部署
- ✅ Nginx配置和SSL证书 (可选)
- ✅ 系统监控配置 (可选)
- ✅ 服务管理脚本创建

### 4.2 部署脚本说明

| 脚本文件 | 功能描述 |
|---------|----------|
| `deploy-all.sh` | 一键部署脚本，完成整个部署流程 |
| `ubuntu-deploy.sh` | Ubuntu系统环境初始化 |
| `setup-database.sh` | 数据库配置和初始化 |
| `deploy-backend.sh` | 后端服务部署 |
| `deploy-frontend.sh` | 前端应用部署 |
| `ssl-setup.sh` | SSL证书配置 |
| `monitor-setup.sh` | 系统监控配置 |

### 4.3 手动部署流程

如果您希望手动控制部署过程，可以按以下步骤执行：

```bash
# 1. 系统环境准备
sudo ./deploy/ubuntu-deploy.sh

# 2. 数据库配置
sudo ./deploy/setup-database.sh

# 3. 后端服务部署
sudo ./deploy/deploy-backend.sh

# 4. 前端应用部署
sudo ./deploy/deploy-frontend.sh

# 5. SSL证书配置 (可选)
sudo ./deploy/ssl-setup.sh

# 6. 系统监控配置 (可选)
sudo ./deploy/monitor-setup.sh
```

---

## 5. 数据库配置

### 4.1 MySQL 安装与配置

#### Ubuntu/Debian 系统
```bash
# 安装 MySQL
sudo apt update
sudo apt install mysql-server

# 启动服务
sudo systemctl start mysql
sudo systemctl enable mysql

# 安全配置
sudo mysql_secure_installation
```

#### CentOS/RHEL 系统
```bash
# 安装 MySQL
sudo yum update
sudo yum install mysql-server

# 启动服务
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

### 4.2 数据库创建
```sql
-- 1. 创建数据库
CREATE DATABASE blog CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 2. 创建用户（生产环境建议使用专用用户）
CREATE USER 'bloguser'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON blog.* TO 'bloguser'@'localhost';
FLUSH PRIVILEGES;

-- 3. 导入表结构（假设有 sql.sql 文件）
USE blog;
SOURCE /path/to/your/sql.sql;
```

### 4.3 MySQL 配置优化
编辑 `/etc/mysql/mysql.conf.d/mysqld.cnf`：
```ini
[mysqld]
# 基础配置
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 性能优化
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
max_connections = 200
query_cache_size = 0
query_cache_type = 0

# 安全配置
bind-address = 127.0.0.1  # 仅本地访问
sql_mode = STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
```

---

## 6. 后端部署

### 5.1 配置文件设置

#### 开发环境 (`application.yml`)
```yaml
spring:
  application:
    name: LiuTech
  main:
    allow-circular-references: true
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
      enabled: true
  datasource:
    url: jdbc:mysql://localhost:3306/blog?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 30000
      connection-timeout: 30000

mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  type-aliases-package: chat.liuxin.liutech.model
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: auto
      table-underline: true
      logic-delete-value: 1
      logic-not-delete-value: 0

server:
  port: 8080
  tomcat:
    uri-encoding: UTF-8

logging:
  level:
    com.baomidou.mybatisplus: debug
    org.hibernate.orm.connections.pooling: WARN
```

#### 生产环境 (`application-prod.yml`)
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/blog?allowPublicKeyRetrieval=true&useSSL=true&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:bloguser}
    password: ${DB_PASSWORD:your_secure_password}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 10

mybatis-plus:
  configuration:
    log-impl: # 生产环境关闭 SQL 日志

server:
  port: ${SERVER_PORT:8080}

logging:
  level:
    root: INFO
    com.baomidou.mybatisplus: WARN
  file:
    name: logs/liutech.log
  logback:
    rollingpolicy:
      max-file-size: 10MB
      max-history: 30

file:
  upload:
    base-path: ${FILE_UPLOAD_PATH:/opt/uploads}
    url-prefix: /uploads
    max-file-size: 104857600  # 100MB
    max-image-size: 10485760  # 10MB
```

### 5.2 构建与部署

#### 本地开发运行
```bash
# 1. 进入后端目录
cd MyBlog/LiuTech

# 2. 编译项目
mvn clean compile

# 3. 运行项目
mvn spring-boot:run
```

#### 生产环境部署
```bash
# 1. 打包项目
cd MyBlog
mvn clean package -DskipTests

# 2. 复制 JAR 文件到服务器
scp LiuTech/target/liutech-backend-*.jar user@server:/opt/liutech/

# 3. 创建启动脚本
cat > /opt/liutech/start.sh << 'EOF'
#!/bin/bash
APP_NAME="liutech-backend"
JAR_FILE="/opt/liutech/liutech-backend-0.0.1-SNAPSHOT.jar"
PID_FILE="/opt/liutech/app.pid"

export JAVA_OPTS="-Xms512m -Xmx2g -Dspring.profiles.active=prod"
export DB_USERNAME="bloguser"
export DB_PASSWORD="your_secure_password"

start() {
    if [ -f $PID_FILE ] && kill -0 $(cat $PID_FILE) 2>/dev/null; then
        echo "Application is already running"
        return 1
    fi
    
    echo "Starting $APP_NAME..."
    nohup java $JAVA_OPTS -jar $JAR_FILE > /opt/liutech/logs/app.log 2>&1 &
    echo $! > $PID_FILE
    echo "$APP_NAME started with PID $(cat $PID_FILE)"
}

stop() {
    if [ ! -f $PID_FILE ]; then
        echo "No PID file found"
        return 1
    fi
    
    PID=$(cat $PID_FILE)
    echo "Stopping $APP_NAME (PID: $PID)..."
    kill $PID
    rm -f $PID_FILE
    echo "$APP_NAME stopped"
}

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        stop
        sleep 2
        start
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
EOF

chmod +x /opt/liutech/start.sh

# 4. 创建 systemd 服务（可选）
cat > /etc/systemd/system/liutech.service << 'EOF'
[Unit]
Description=LiuTech Blog Backend
After=network.target mysql.service

[Service]
Type=forking
User=www-data
Group=www-data
WorkingDirectory=/opt/liutech
ExecStart=/opt/liutech/start.sh start
ExecStop=/opt/liutech/start.sh stop
ExecReload=/opt/liutech/start.sh restart
PIDFile=/opt/liutech/app.pid
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# 启用服务
sudo systemctl daemon-reload
sudo systemctl enable liutech
sudo systemctl start liutech
```

---

## 7. 前端部署

### 6.1 开发环境运行
```bash
# 1. 进入前端目录
cd MyBlog/Web

# 2. 安装依赖
npm install

# 3. 启动开发服务器
npm run dev
```

### 6.2 生产环境构建
```bash
# 1. 构建生产版本
npm run build

# 2. 构建产物在 dist/ 目录
ls -la dist/
```

### 6.3 环境变量配置

#### 开发环境 (`.env.development`)
```env
VITE_APP_TITLE=LiuTech 博客系统
VITE_API_BASE_URL=http://localhost:8080
VITE_APP_VERSION=1.0.0
```

#### 生产环境 (`.env.production`)
```env
VITE_APP_TITLE=LiuTech 博客系统
VITE_API_BASE_URL=https://api.liutech.com
VITE_APP_VERSION=1.0.0
```

---

## 8. Nginx 配置

### 7.1 安装 Nginx
```bash
# Ubuntu/Debian
sudo apt install nginx

# CentOS/RHEL
sudo yum install nginx
```

### 7.2 站点配置
创建 `/etc/nginx/sites-available/liutech`：
```nginx
# LiuTech 博客系统配置
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    root /var/www/liutech;
    index index.html index.htm;

    # 前端静态文件
    location / {
        try_files $uri $uri/ /index.html;
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    # 后端 API 代理
    location /api/ {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时配置
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # 缓冲配置
        proxy_buffering on;
        proxy_buffer_size 8k;
        proxy_buffers 8 8k;
    }

    # 文件上传接口
    location /uploads/ {
        proxy_pass http://localhost:8080/uploads/;
        client_max_body_size 100M;
        proxy_request_buffering off;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # 安全头
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    # Gzip 压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml;
}

# HTTPS 重定向（生产环境）
server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    ssl_certificate /path/to/ssl/certificate.crt;
    ssl_certificate_key /path/to/ssl/private.key;
    
    # SSL 优化配置
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # 其他配置同上...
}
```

### 7.3 启用站点
```bash
# 创建软链接
sudo ln -s /etc/nginx/sites-available/liutech /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重启 Nginx
sudo systemctl reload nginx
```

---

## 9. Docker 容器化部署

### 8.1 Dockerfile 配置

#### 后端 Dockerfile (`LiuTech/Dockerfile`)
```dockerfile
FROM openjdk:21-jdk-slim

LABEL maintainer="刘鑫"
LABEL description="LiuTech 博客系统后端"

# 工作目录
WORKDIR /app

# 复制 jar 文件
COPY target/liutech-backend-*.jar app.jar

# 创建日志目录
RUN mkdir -p /app/logs

# 暴露端口
EXPOSE 8080

# 健康检查
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

# 启动命令
ENTRYPOINT ["java", "-Dspring.profiles.active=prod", "-Xms512m", "-Xmx2g", "-jar", "app.jar"]
```

#### 前端 Dockerfile (`Web/Dockerfile`)
```dockerfile
# 构建阶段
FROM node:20-alpine AS build

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

# 生产阶段
FROM nginx:alpine

LABEL maintainer="刘鑫"
LABEL description="LiuTech 博客系统前端"

# 复制构建产物
COPY --from=build /app/dist /usr/share/nginx/html

# 复制 Nginx 配置
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 暴露端口
EXPOSE 80

# 启动 Nginx
CMD ["nginx", "-g", "daemon off;"]
```

### 8.2 Docker Compose 配置
创建 `docker-compose.yml`：
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: liutech-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: blog
      MYSQL_USER: bloguser
      MYSQL_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./sql.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - liutech-network
    restart: unless-stopped

  backend:
    build:
      context: ./LiuTech
      dockerfile: Dockerfile
    container_name: liutech-backend
    environment:
      SPRING_PROFILES_ACTIVE: prod
      DB_HOST: mysql
      DB_USERNAME: bloguser
      DB_PASSWORD: ${DB_PASSWORD}
    ports:
      - "8080:8080"
    volumes:
      - uploads_data:/opt/uploads
      - backend_logs:/app/logs
    depends_on:
      - mysql
    networks:
      - liutech-network
    restart: unless-stopped

  frontend:
    build:
      context: ./Web
      dockerfile: Dockerfile
    container_name: liutech-frontend
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./ssl:/etc/nginx/ssl:ro  # SSL 证书
    depends_on:
      - backend
    networks:
      - liutech-network
    restart: unless-stopped

volumes:
  mysql_data:
  uploads_data:
  backend_logs:

networks:
  liutech-network:
    driver: bridge
```

### 8.3 环境变量文件
创建 `.env`：
```env
# 数据库配置
DB_ROOT_PASSWORD=your_root_password
DB_PASSWORD=your_secure_password

# 应用配置
APP_ENV=production
JWT_SECRET=your_jwt_secret_key

# 文件上传配置
FILE_UPLOAD_PATH=/opt/uploads
```

### 8.4 Docker 部署命令
```bash
# 构建并启动所有服务
docker-compose up -d --build

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f backend

# 停止服务
docker-compose down

# 备份数据卷
docker run --rm -v liutech_mysql_data:/data -v $(pwd):/backup alpine tar czf /backup/mysql_backup.tar.gz -C /data .
```

---

## 10. 环境变量配置

### 9.1 系统环境变量
```bash
# 在 ~/.bashrc 或 /etc/environment 中添加
export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
export SPRING_PROFILES_ACTIVE=prod
export DB_PASSWORD=your_secure_password
export JWT_SECRET=your_jwt_secret_key
export FILE_UPLOAD_PATH=/opt/uploads
```

### 9.2 应用配置
后端支持通过环境变量覆盖配置：
- `DB_USERNAME`：数据库用户名
- `DB_PASSWORD`：数据库密码
- `SERVER_PORT`：服务端口
- `FILE_UPLOAD_PATH`：文件上传路径

---

## 11. 监控与维护

### 10.1 日志管理
```bash
# 查看应用日志
tail -f /opt/liutech/logs/app.log

# 查看 Nginx 日志
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# 日志轮转配置
cat > /etc/logrotate.d/liutech << 'EOF'
/opt/liutech/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    copytruncate
}
EOF
```

### 10.2 性能监控
```bash
# 系统资源监控
htop
iostat -x 1

# Java 应用监控
jps -l
jstat -gc <pid> 250

# 数据库监控
mysqladmin -u root -p processlist
mysqladmin -u root -p status
```

### 10.3 备份策略
```bash
# 数据库备份脚本
cat > /opt/scripts/backup_db.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/backups/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="blog"

mkdir -p $BACKUP_DIR

mysqldump -u bloguser -p$DB_PASSWORD $DB_NAME | gzip > $BACKUP_DIR/blog_$DATE.sql.gz

# 删除 7 天前的备份
find $BACKUP_DIR -name "blog_*.sql.gz" -mtime +7 -delete
EOF

chmod +x /opt/scripts/backup_db.sh

# 添加到 crontab
echo "0 2 * * * /opt/scripts/backup_db.sh" | crontab -
```

---

## 12. 故障排除

### 11.1 常见问题

#### 后端启动失败
```bash
# 检查端口占用
netstat -tlnp | grep 8080

# 检查 Java 进程
jps -l

# 查看启动日志
tail -f /opt/liutech/logs/app.log
```

#### 数据库连接失败
```bash
# 测试数据库连接
mysql -u bloguser -p -h localhost blog

# 检查 MySQL 状态
systemctl status mysql
```

#### 前端页面 404
```bash
# 检查 Nginx 配置
nginx -t

# 查看 Nginx 错误日志
tail -f /var/log/nginx/error.log
```

#### 文件上传失败
```bash
# 检查上传目录权限
ls -la /opt/uploads
chown -R www-data:www-data /opt/uploads
chmod -R 755 /opt/uploads
```

### 11.2 性能优化建议

1. **数据库优化**
   - 添加适当的索引
   - 配置 MySQL 参数优化
   - 定期分析慢查询

2. **应用层优化**
   - 启用 JVM 参数调优
   - 配置连接池参数
   - 实施缓存策略

3. **前端优化**
   - 启用 Gzip 压缩
   - 配置静态资源缓存
   - 使用 CDN 加速

---

## 📞 联系支持

如有部署问题，请联系：
- **邮箱**：your-email@example.com
- **项目仓库**：[GitHub 地址]
- **文档更新**：2025-08-27

---

*本文档将根据项目发展持续更新，请关注最新版本。*