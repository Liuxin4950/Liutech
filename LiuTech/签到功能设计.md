# 签到功能设计文档

## 数据库设计

### 签到记录表 (user_checkins)

```sql
CREATE TABLE IF NOT EXISTS user_checkins (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '签到记录ID',
  user_id BIGINT NOT NULL COMMENT '用户ID',
  checkin_date DATE NOT NULL COMMENT '签到日期',
  points_earned DECIMAL(12,2) NOT NULL DEFAULT 1.00 COMMENT '获得积分',
  consecutive_days INT UNSIGNED NOT NULL DEFAULT 1 COMMENT '连续签到天数',
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '签到时间',
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY uk_user_date (user_id, checkin_date) COMMENT '用户日期唯一索引',
  INDEX idx_user_id (user_id),
  INDEX idx_checkin_date (checkin_date),
  FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户签到记录表';
```

## API接口设计

### 1. 每日签到接口

**接口地址：** `POST /user/checkin`

**接口描述：** 用户每日签到，获得积分奖励

**认证要求：** 需要用户认证

**请求头：**
```
Authorization: Bearer {token}
Content-Type: application/json
```

**成功响应：**
```json
{
  "code": 200,
  "message": "签到成功",
  "data": {
    "pointsEarned": 1.00,
    "totalPoints": 101.00,
    "consecutiveDays": 5,
    "checkinDate": "2025-01-30"
  }
}
```

**错误响应：**
| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 1301 | 今日已签到 | 用户今天已经签到过 |
| 401 | 未授权访问，请先登录 | Token无效或过期 |

### 2. 获取签到状态接口

**接口地址：** `GET /user/checkin/status`

**接口描述：** 获取用户今日签到状态和连续签到天数

**认证要求：** 需要用户认证

**请求头：**
```
Authorization: Bearer {token}
```

**成功响应：**
```json
{
  "code": 200,
  "message": "获取签到状态成功",
  "data": {
    "hasCheckedInToday": true,
    "consecutiveDays": 5,
    "lastCheckinDate": "2025-01-30",
    "totalCheckins": 25
  }
}
```

## 业务逻辑

### 签到规则
1. 每日只能签到一次
2. 基础签到奖励：1积分
3. 连续签到奖励：
   - 连续7天：额外1积分
   - 连续30天：额外5积分
4. 断签后连续天数重置为1

### 积分更新
1. 签到成功后更新用户积分
2. 记录签到日志
3. 计算连续签到天数

## 前端功能

### 签到按钮
- 显示在个人信息页面
- 已签到状态：灰色按钮，显示"今日已签到"
- 未签到状态：蓝色按钮，显示"每日签到"
- 显示连续签到天数

### 签到提示
- 签到成功：显示获得积分数量
- 连续签到奖励：特殊提示
- 签到失败：显示错误信息