# 目前开发清单（持续更新）

> 作者：刘鑫  
> 更新时间：2025-08-27

## 一、整体规划与规范
- [ ] 统一前端样式：尽量复用 `src/assets/styles/styles.css` 与 `theme.css` 的工具类，页面内样式仅保留必要覆盖，减少自定义 CSS。
- [ ] 接口返回统一封装与错误码规范：后端定义标准响应模型（code、msg、data），前端 `services/api.ts` 保持一致解析与错误提示。
- [ ] 统一日志规范：后端按模块划分日志级别与输出格式，生产环境关闭 MyBatis SQL DEBUG。
- [ ] 统一异常处理：全局异常处理器（ControllerAdvice）输出一致结构；前端 `globalErrorHandler.ts` 已配置，需对接后端错误码。
- [ ] 安全基线：JWT 过期刷新、权限注解与 URL 级鉴权、CSRF 评估（REST 通常关闭）、限流（登录/评论）。

## 二、数据库与数据模型
- [ ] 点赞/收藏第三范式改造（替代文章表的 like 字段）：
  - `likes`（id, user_id, article_id, is_like[0/1], create_time）
  - `collections`（id, user_id, article_id, is_collect[0/1], create_time）
  - 约束：唯一索引 (user_id, article_id)
  - 影响面：Mapper、Service、Controller、返回DTO、前端接口与状态联动
- [ ] 文章搜索索引：MySQL FULLTEXT（title, summary, content），或后续接入 Elasticsearch（后期）。
- [ ] 文件上传表：记录文件元数据（file_id, url, type, size, uploader, create_time），支持清理与复用。

## 三、后端待办（Spring Boot, MyBatis-Plus, Security, JWT）
- [ ] 响应体统一：定义 `CommonResult<T>`，在所有 Controller 返回；异常通过全局处理器转换。
- [ ] 认证与权限：
  - [ ] 登录成功返回 `token` 与 `expireAt`；
  - [ ] JWT 过滤器完善 401/403 响应体；
  - [ ] 基于注解的权限控制（@PreAuthorize）。
- [ ] 公告模块：补充分页、状态（发布/下线）、置顶字段。
- [ ] 文章模块：
  - [ ] 点赞/收藏 API（幂等切换）
  - [ ] 草稿/发布状态，发布时间字段
  - [ ] 标签多对多维护接口
- [ ] 文件上传：
  - [ ] 校验白名单（图片/文档）与大小限制
  - [ ] 统一上传目录，URL 前缀 `/uploads`
  - [ ] 断点续传/大文件（后期）
- [ ] 统一分页与排序参数（page, pageSize, sortField, sortOrder）
- [ ] Swagger/OpenAPI 文档增强（如 Springdoc）。

## 四、前端待办（Vue 3 + TS + Vite + Pinia + Router）
- [ ] API 基址配置化：从 `import.meta.env.VITE_API_BASE_URL` 读取，默认 `http://localhost:8080`；本地已在 `services/api.ts` 指向 8080。
- [ ] 全局错误与登录态：401 自动跳转登录，保留回跳；全局 Toast/Modal 提示（SweetAlert2）。
- [ ] 主题与样式：继续复用 `styles.css` 和 `theme.css`，减少页面内 `scoped` 复杂样式。
- [ ] 路由滚动：`router/index.ts` 已配置 `scrollBehavior`，确认前进/后退恢复位置。
- [ ] 列表组件：通用分页表格/卡片 + 加载骨架屏。
- [ ] 文章详情：点赞/收藏交互与本地态展示（已登录校验）。
- [ ] 富文本编辑：TinyMCE 图片上传适配 `/uploads`，插入回显。
- [ ] SEO 与可访问性：动态标题、描述，基础语义标签，键盘可达性。

## 五、部署与运维
- [ ] Nginx 反向代理与静态资源缓存策略上线验证。
- [ ] Docker 化：前后端与 MySQL docker-compose 一键启动；挂载日志与上传目录。
- [ ] CI/CD：GitHub Actions 构建前端，发布至服务器/对象存储；后端打包并分发。
- [ ] 监控与告警：进程探活、磁盘/CPU、应用日志异常采集。

## 六、测试计划
- [ ] 单元测试：Service 层（点赞/收藏幂等、权限控制）。
- [ ] 接口测试：登录、文章增删改查、文件上传、公告分页。
- [ ] 前端 E2E：文章发布流程、登录态过期处理、主题切换持久化。
- [ ] 性能测试：列表接口分页响应 < 300ms（P95）。

## 七、Live2D + AI 微服务架构规划（基于本地Ollama）
### 7.1 架构设计
- [ ] **微服务拆分方案**：
  - 核心服务（现有LiuTech项目）：用户管理、文章管理、基础功能
  - AI文本服务：本地Ollama调用、对话逻辑处理、上下文管理
  - 语音服务：TTS/STT，按需启动的资源密集型服务
  - API网关：统一入口、路由分发、认证鉴权

### 7.2 技术选型（本地化方案）
- [ ] **AI文本服务**：Spring Boot + Ollama Java Client 或 Python FastAPI + Ollama REST API
- [ ] **本地模型**：Ollama部署（qwen2.5:7b、llama3.1:8b等中文友好模型）
- [ ] **语音服务**：Python + 本地TTS模型（如edge-tts、piper-tts）
- [ ] **服务通信**：HTTP REST API
- [ ] **容器化**：Docker + docker-compose（包含Ollama容器）
- [ ] **配置管理**：Spring Cloud Config 或 简单配置文件

### 7.3 实施阶段（严格规划）
#### **阶段一：Spring AI集成（推荐优先）**
- [ ] **1.1 环境准备**：
  - [ ] 本地安装Ollama服务（端口11434）
  - [ ] 下载并测试中文模型（qwen2.5:7b）
  - [ ] 验证Ollama REST API可用性

- [ ] **1.2 Spring AI集成**：
  - [ ] 在现有LiuTech项目中添加Spring AI依赖
  - [ ] 配置Ollama连接（application.yml）
  - [ ] 创建AIService层，封装对话逻辑
  - [ ] 实现RESTful API：`/api/ai/chat`

- [ ] **1.3 前端集成**：
  - [ ] 在Live2D组件中添加AI对话功能
  - [ ] 实现对话历史管理
  - [ ] 添加打字机效果和语音播放

#### **阶段二：微服务拆分（可选进阶）**
- [ ] **2.1 AI服务独立化**：
  - [ ] 创建独立的AI服务项目（Spring Boot）
  - [ ] 迁移AI相关代码到独立服务
  - [ ] 配置服务间HTTP通信
  - [ ] 实现服务健康检查

- [ ] **2.2 语音服务开发**：
  - [ ] 创建Python语音服务（FastAPI）
  - [ ] 集成本地TTS模型（edge-tts）
  - [ ] 实现文本转语音API：`/api/voice/tts`
  - [ ] 添加语音文件缓存机制

#### **阶段三：完善微服务生态**
- [ ] **3.1 服务治理**：
  - [ ] 配置Nginx作为API网关
  - [ ] 实现服务发现（简单配置文件）
  - [ ] 添加服务监控（Spring Boot Actuator）

- [ ] **3.2 容器化部署**：
  - [ ] 编写Docker Compose配置
  - [ ] 包含：核心服务、AI服务、语音服务、Ollama、MySQL
  - [ ] 配置数据卷挂载和网络通信

### 7.4 本地化数据交换方案
- [ ] **同步通信**：HTTP REST API（主要）
- [ ] **模型调用**：直接调用本地Ollama API（http://localhost:11434）
- [ ] **缓存策略**：Redis缓存对话上下文和TTS音频文件
- [ ] **容错机制**：Ollama服务不可用时的降级策略

### 7.5 本地化优势与考虑
**优势**：
- ✅ **数据隐私**：所有AI处理完全本地化，无数据泄露风险
- ✅ **成本控制**：无API调用费用，长期运行成本低
- ✅ **响应速度**：本地调用，无网络延迟
- ✅ **离线可用**：不依赖外网，稳定性高
- ✅ **模型可控**：可自由选择和切换本地模型

**技术考虑**：
- ⚠️ **硬件要求**：需要足够的GPU/CPU资源运行大模型
- ⚠️ **模型性能**：本地模型可能不如GPT-4等云端模型
- ⚠️ **存储空间**：模型文件占用较大磁盘空间（7B模型约4-8GB）
- ⚠️ **维护成本**：需要管理模型更新和服务稳定性

### 7.6 推荐实施路径
**优先级排序**：
1. **高优先级**：阶段一Spring AI集成（技术栈统一，快速见效）
2. **中优先级**：语音服务开发（提升用户体验）
3. **低优先级**：微服务拆分（架构优化，按需实施）

**决策建议**：
- 如果团队Java背景强：优先Spring AI方案
- 如果需要复杂AI功能：考虑Python微服务
- 如果追求简单稳定：建议单体架构集成Ollama

## 八、里程碑
- M1（本周）：
  - [ ] 完成点赞/收藏表与后端 API
  - [ ] 前端点赞/收藏交互 + 统一错误处理
- M2（下周）：
  - [ ] Docker 化与 Nginx 上线
  - [ ] CI/CD 初版
- M3（两周后）：
  - [ ] 搜索优化 + SEO + 监控告警
- M4（AI微服务，一个月后）：
  - [ ] AI文本服务独立部署
  - [ ] Live2D集成AI对话功能
- M5（完整微服务，两个月后）：
  - [ ] 语音服务分离与按需启动
  - [ ] 微服务监控与治理完善

---

提示：开发中如遇异常，优先检查 `services/api.ts` 的 baseURL（默认 http://localhost:8080），以及后端端口、数据库连接与 JWT 过期时间设置。



